<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events Page</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #831238;
        --primary-dark: #6d0f2a;
        --primary-light: #a51649;
        --accent: #66bb6a;
        --accent-hover: #5aa456;
        --bg-light: #f8f9fa;
        --bg-gray: #f5f5f7;
        --text-dark: #333;
        --text-light: #fff;
        --border-radius: 12px;
        --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.08);
        --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.12);
        --shadow-lg: 0 6px 16px rgba(0, 0, 0, 0.16);
        --transition: all 0.3s ease;
        --gray-100: #f3f4f6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f9fafb;
        color: var(--text-dark);
        line-height: 1.6;
      }

      header {
        background-color: rgba(255, 255, 255, 0.95);
        box-shadow: var(--shadow-lg);
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(10px);
      }

      .header-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem;
        max-width: 1200px;
        margin: 0 auto;
      }

      .left-section {
        display: flex;
        align-items: center;
        gap: 16px;
      }

      .header-title {
        font-weight: 700;
        font-size: 1.25rem;
        color: #5c1e3c;
      }

      .logo {
        font-weight: 700;
        font-size: 1.25rem;
        color: var(--primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .icon-button {
        background: none;
        border: none;
        cursor: pointer;
        color: var(--text-dark);
        font-size: 1.25rem;
        padding: 0.5rem;
        border-radius: 50%;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
      }

      .icon-button:hover {
        background-color: var(--gray-100);
        color: var(--primary);
      }

      .menu-button {
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5rem;
        border-radius: 0.375rem;
        font-size: 1.25rem;
        color: var(--text-dark);
        transition: all 0.2s ease;
      }

      .menu-button:hover {
        background-color: var(--gray-100);
        color: var(--primary);
      }

      .mobile-menu {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 999;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
        backdrop-filter: blur(5px);
      }

      .mobile-menu.active {
        opacity: 1;
        pointer-events: auto;
      }

      .menu-content {
        position: absolute;
        top: 0;
        left: 0;
        width: 80%;
        max-width: 300px;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.5);
        box-shadow: var(--shadow-lg), 0 0 20px rgba(0, 0, 0, 0.1);
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        padding: 2rem 1rem;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        backdrop-filter: blur(10px);
      }

      .mobile-menu.active .menu-content {
        transform: translateX(0);
      }

      .menu-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .menu-close {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--text-dark);
      }

      .menu-close:hover {
        color: var(--primary);
      }

      .menu-links {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .menu-links a {
        color: var(--text-dark);
        text-decoration: none;
        font-weight: 500;
        padding: 0.75rem 1rem;
        border-radius: 0.375rem;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .menu-links a i {
        color: var(--primary);
        font-size: 1.1rem;
        width: 20px;
      }

      .menu-links a:hover {
        background-color: var(--gray-100);
        color: var(--primary);
      }

      .menu-links a.active {
        background-color: rgba(255, 255, 255, 0.5);
        color: var(--primary);
        font-weight: 600;
      }

      .container {
        flex: 1;
        padding: 24px;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .page-title {
        margin-bottom: 24px;
        color: var(--primary);
        font-size: 24px;
        font-weight: 600;
      }

      .search-container {
        position: relative;
        margin-bottom: 24px;
      }

      #search {
        width: 100%;
        padding: 14px 20px 14px 48px;
        border: none;
        border-radius: var(--border-radius);
        background-color: white;
        box-shadow: var(--shadow-sm);
        font-size: 16px;
        transition: var(--transition);
      }

      #search:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(131, 18, 56, 0.2);
      }

      .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #999;
      }

      .events-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 24px;
        margin-bottom: 24px;
      }

      .event-card {
        background-color: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
      }

      .event-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-md);
      }

      .event-image {
        height: 180px;
        overflow: hidden;
        position: relative;
        cursor: pointer;
      }

      .event-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: var(--transition);
      }

      .event-card:hover .event-image img {
        transform: scale(1.05);
      }

      .event-type-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .event-type-badge.technical {
        background-color: #e3f2fd;
        color: #1976d2;
      }

      .event-type-badge.non-technical {
        background-color: #fff8e1;
        color: #ff8f00;
      }

      .eligibility-badge {
        position: absolute;
        top: 12px;
        left: 12px;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .eligibility-badge.yes {
        background-color: #e8f5e9;
        color: #2e7d32;
      }

      .eligibility-badge.no {
        background-color: #ffebee;
        color: #c62828;
      }

      .event-details {
        padding: 20px;
      }

      .event-name {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--text-dark);
      }

      .event-info {
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        color: #666;
        font-size: 14px;
      }

      .event-info i {
        width: 20px;
        margin-right: 8px;
        color: var(--primary);
      }

      .event-actions {
        margin-top: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .btn {
        padding: 10px 20px;
        border-radius: var(--border-radius);
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        font-size: 15px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background-color: var(--primary);
        color: white;
      }

      .btn-primary:hover {
        background-color: var(--primary-dark);
      }

      .btn-outline {
        background-color: transparent;
        border: 1px solid var(--primary);
        color: var(--primary);
      }

      .btn-outline:hover {
        background-color: rgba(131, 18, 56, 0.1);
      }

      .btn-success {
        background-color: var(--accent);
        color: white;
      }

      .btn-success:hover {
        background-color: var(--accent-hover);
      }

      .btn-warning {
        background-color: var(--primary);
        color: white;
      }

      .btn-warning:hover {
        background-color: var(--primary-dark);
      }

      .btn-success:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
      }

      .modal-content {
        background-color: white;
        padding: 24px;
        border-radius: var(--border-radius);
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        animation: modalOpen 0.3s ease;
      }

      @keyframes modalOpen {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .modal-close {
        position: absolute;
        top: 16px;
        right: 16px;
        font-size: 20px;
        cursor: pointer;
        color: #666;
        transition: var(--transition);
      }

      .modal-close:hover {
        color: var(--primary);
      }

      .modal-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: var(--border-radius);
        margin-bottom: 16px;
      }

      .modal-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 12px;
      }

      .modal-details {
        margin-bottom: 20px;
      }

      .modal-details p {
        margin-bottom: 8px;
        display: flex;
        align-items: center;
      }

      .modal-details i {
        width: 24px;
        color: var(--primary);
        margin-right: 8px;
      }

      .modal-description {
        margin-bottom: 20px;
        line-height: 1.6;
        color: #555;
      }

      .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
      }

      .no-events {
        text-align: center;
        padding: 40px 20px;
        background-color: white;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-sm);
        margin-top: 20px;
      }

      .no-events i {
        font-size: 48px;
        color: #ccc;
        margin-bottom: 16px;
      }

      .no-events p {
        color: #666;
        font-size: 18px;
      }

      /* Image Gallery in Modal */
      .modal-gallery {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
        overflow-x: auto;
        padding-bottom: 8px;
      }

      .modal-gallery img {
        width: 80px;
        height: 60px;
        object-fit: cover;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        border: 2px solid transparent;
      }

      .modal-gallery img:hover {
        transform: scale(1.05);
      }

      .modal-gallery img.active {
        border-color: var(--primary);
      }

      /* Edit Modal */
      .edit-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(5px);
      }

      .edit-modal-content {
        background-color: white;
        padding: 24px;
        border-radius: var(--border-radius);
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        animation: modalOpen 0.3s ease;
      }

      .form-group {
        margin-bottom: 16px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--text-dark);
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: var(--border-radius);
        font-size: 16px;
        transition: var(--transition);
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(131, 18, 56, 0.2);
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      .image-upload {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .image-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 12px;
      }

      .image-preview-item {
        position: relative;
        width: 100px;
        height: 80px;
        border-radius: 6px;
        overflow: hidden;
      }

      .image-preview-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .remove-image {
        position: absolute;
        top: 4px;
        right: 4px;
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: var(--transition);
      }

      .remove-image:hover {
        background-color: rgba(0, 0, 0, 0.9);
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
      }

      .file-input-button {
        padding: 10px 16px;
        background-color: var(--primary);
        color: white;
        border-radius: var(--border-radius);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .file-input-button:hover {
        background-color: var(--primary-dark);
      }

      .file-input {
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        width: 100%;
        height: 100%;
        cursor: pointer;
      }

      /* Zoom Modal */
      .zoom-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.9);
        z-index: 1100;
        align-items: center;
        justify-content: center;
      }

      .zoom-container {
        position: relative;
        width: 90%;
        max-width: 800px;
        max-height: 90vh;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .zoom-image {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
        border-radius: 4px;
      }

      .zoom-close {
        position: absolute;
        top: -40px;
        right: 0;
        font-size: 24px;
        color: white;
        cursor: pointer;
        background: none;
        border: none;
        transition: all 0.2s ease;
      }

      .zoom-close:hover {
        color: #ddd;
      }

      .zoom-controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 16px;
      }

      .zoom-control {
        background: none;
        border: none;
        color: white;
        font-size: 24px;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 48px;
        height: 48px;
      }

      .zoom-control:hover {
        background-color: rgba(255, 255, 255, 0.2);
      }

      .zoom-indicators {
        display: flex;
        gap: 8px;
        margin-top: 16px;
      }

      .zoom-indicator {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .zoom-indicator.active {
        background-color: white;
        transform: scale(1.2);
      }

      /* Responsive styles */
      @media (max-width: 768px) {
        .events-grid {
          grid-template-columns: 1fr;
        }

        .header-container {
          padding: 12px 16px;
        }

        .header-title {
          font-size: 18px;
        }

        .container {
          padding: 16px;
        }

        .zoom-container {
          width: 95%;
        }
      }

      @media (max-width: 480px) {
        .menu-links a {
          font-size: 14px;
          padding: 8px 12px;
        }

        .btn {
          padding: 8px 16px;
          font-size: 14px;
        }

        .page-title {
          font-size: 20px;
        }

        .zoom-controls {
          gap: 12px;
        }

        .zoom-control {
          font-size: 20px;
          width: 40px;
          height: 40px;
        }
      }
    </style>
  </head>
  <body>
    <header>
    <div class="header-container">
        <div class="left-section">
            <button class="menu-button" id="menu-toggle" aria-label="Toggle menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div class="header-title">Events Ongoing</div>
        <div class="header-actions">
            <button class="icon-button" title="Language" aria-label="Language">
                <i class="fas fa-globe"></i>
            </button>
            <button class="icon-button" title="Notifications" aria-label="Notifications">
                <i class="fas fa-bell"></i>
            </button>
            <button class="icon-button" title="Account" aria-label="Account" 
                    th:onclick="'window.location.href=\'' + @{/admin/profile} + '\'"'>
                <i class="fas fa-user-circle"></i>
            </button>
        </div>
    </div>
</header>

<!-- Mobile menu -->
<div class="mobile-menu" id="mobile-menu">
    <div class="menu-content">
        <div class="menu-header">
            <div class="logo">
                <i class="fas fa-user-tie"></i>
                <span>Admin Portal</span>
            </div>
            <button class="menu-close" id="menu-close" aria-label="Close menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="menu-links">
            <a th:href="@{/}"><i class="fas fa-sign-in-alt"></i> Login</a>
            <a th:href="@{/admin/profile}"><i class="fas fa-user"></i> Profile</a>
            <a th:href="@{/events/upcoming}"><i class="fas fa-calendar-day"></i> Events Upcoming</a>
            <a th:href="@{/events/ongoing}" class="active"><i class="fas fa-check-circle"></i> Events Ongoing</a>
            <a th:href="@{/events/completed}"><i class="fas fa-calendar"></i> Events Completed</a>
            <a th:href="@{/events/approval}"><i class="fas fa-clipboard-check"></i> Events Approval</a>
            <a th:href="@{/admin/messenger}"><i class="fas fa-comments"></i> Messenger</a>
        </div>
    </div>
</div>

<div class="container">
    <h1 class="page-title">Events Ongoing</h1>
    <div class="search-container">
        <i class="fas fa-search search-icon"></i>
        <input id="search" type="text" placeholder="Search events or faculty" autocomplete="off">
    </div>

    <div class="events-grid">
        <!-- Show "No events" if empty -->
        <div th:if="${#lists.isEmpty(events)}" class="no-events">
            <i class="fas fa-calendar-times"></i>
            <p>No ongoing events found</p>
        </div>

        <!-- Loop through events -->
        <div th:each="event : ${events}" class="event-card">
            <!-- <div class="event-image" th:attr="data-event-id=${event.id}">
                <img th:src="${event.images[0]}" th:alt="${event.name}">
                <div class="event-type-badge" th:text="${event.type}"></div>
                <div class="eligibility-badge" 
                     th:classappend="${event.eligible} ? ' yes' : ' no'"
                     th:text="${event.eligible} ? 'Eligible' : 'Not Eligible'"></div>
            </div> -->
            <div class="event-details">
                <h3 class="event-name" th:text="${event.name}"></h3>
                <div class="event-info"><i class="fas fa-map-marker-alt"></i> <span th:text="${event.venue}"></span></div>
                <div class="event-info"><i class="fas fa-calendar"></i> 
                    <span th:text="${#temporals.format(event.startTime,'dd MMM yyyy')}"></span>
                </div>
                <div class="event-info"><i class="fas fa-clock"></i> 
                    <span th:text="${#temporals.format(event.startTime,'HH:mm')} + ' - ' + ${#temporals.format(event.endTime,'HH:mm')}"></span>
                </div>
                <div class="event-actions">
                    <button class="btn btn-outline view-details" th:attr="data-event-id=${event.id}">
                        <i class="fas fa-info-circle"></i> View Details
                    </button>
                    <button class="btn btn-warning edit-btn" th:attr="data-event-id=${event.id}">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

    <script>
      // Array to store events dynamically fetched from backend
      let events = [];

      // Global variables
      let currentEventId = null;
      let currentImageIndex = 0;
      let currentEventImages = [];
      let currentEventBeingEdited = null;

      document.addEventListener("DOMContentLoaded", async function () {
        initializeMenu();
        await fetchOngoingEvents();
        initializeSearch();
        initializeEditForm();
      });

      async function fetchOngoingEvents() {
        try {
          const response = await fetch("/api/v1/events/ongoing");
          if (!response.ok) throw new Error("Failed to fetch ongoing events");
          events = await response.json();

          events = events.map((event) => ({
            id: event.id,
            name: event.title,
            venue: event.location,
            date: new Date(event.startTime).toLocaleDateString(),
            time: `${new Date(
              event.startTime
            ).toLocaleTimeString()} - ${new Date(
              event.endTime
            ).toLocaleTimeString()}`,
            type: event.type || "Technical",
            eligibility: event.eligibility || "Open for all students",
            description: event.description,
            images:
              event.images && event.images.length
                ? event.images
                : ["https://picsum.photos/800/600"],
            isEligible:
              event.isEligible !== undefined ? event.isEligible : true,
          }));

          renderEvents();
        } catch (err) {
          console.error(err);
          document.getElementById("events-container").innerHTML = `
                    <div class="no-events">
                        <i class="fas fa-calendar-times"></i>
                        <p>Failed to load ongoing events</p>
                    </div>
                `;
        }
      }

      function initializeMenu() {
        const menuToggle = document.getElementById("menu-toggle");
        const menuClose = document.getElementById("menu-close");
        const mobileMenu = document.getElementById("mobile-menu");

        menuToggle.addEventListener("click", () =>
          mobileMenu.classList.add("active")
        );
        menuClose.addEventListener("click", () =>
          mobileMenu.classList.remove("active")
        );
        mobileMenu.addEventListener("click", (e) => {
          if (e.target === mobileMenu) mobileMenu.classList.remove("active");
        });
      }

      function renderEvents() {
        const container = document.getElementById("events-container");
        container.innerHTML = "";
        if (events.length === 0) {
          container.innerHTML = `<div class="no-events"><i class="fas fa-calendar-times"></i><p>No events found</p></div>`;
          return;
        }

        events.forEach((event) => {
          const card = document.createElement("div");
          card.className = "event-card";
          card.innerHTML = `
                    <div class="event-image" data-event-id="${event.id}">
                        <img src="${event.images[0]}" alt="${event.name}">
                        <div class="event-type-badge ${event.type.toLowerCase()}">${
            event.type
          }</div>
                        <div class="eligibility-badge ${
                          event.isEligible ? "yes" : "no"
                        }">
                            ${event.isEligible ? "Eligible" : "Not Eligible"}
                        </div>
                    </div>
                    <div class="event-details">
                        <h3 class="event-name">${event.name}</h3>
                        <div class="event-info"><i class="fas fa-map-marker-alt"></i> ${
                          event.venue
                        }</div>
                        <div class="event-info"><i class="fas fa-calendar"></i> ${
                          event.date
                        }</div>
                        <div class="event-info"><i class="fas fa-clock"></i> ${
                          event.time
                        }</div>
                        <div class="event-actions">
                            <button class="btn btn-outline view-details" data-event-id="${
                              event.id
                            }">
                                <i class="fas fa-info-circle"></i> View Details
                            </button>
                            <button class="btn btn-warning edit-btn" data-event-id="${
                              event.id
                            }">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    </div>
                `;
          container.appendChild(card);
        });
        attachEventListeners();
      }

      function attachEventListeners() {
        document
          .querySelectorAll(".event-image")
          .forEach((img) =>
            img.addEventListener("click", () =>
              openZoomModal(parseInt(img.dataset.eventId), 0)
            )
          );
        document
          .querySelectorAll(".view-details")
          .forEach((btn) =>
            btn.addEventListener("click", () =>
              openEventModal(parseInt(btn.dataset.eventId))
            )
          );
        document
          .querySelectorAll(".edit-btn")
          .forEach((btn) =>
            btn.addEventListener("click", () =>
              openEditModal(parseInt(btn.dataset.eventId))
            )
          );
      }
      // Open event details modal
      function openEventModal(eventId) {
        const event = events.find((e) => e.id === eventId);
        if (!event) return;

        currentEventId = eventId;
        currentEventImages = event.images;
        currentImageIndex = 0;

        // Set modal content
        document.getElementById("modal-image").src = event.images[0];
        document.getElementById("modal-title").textContent = event.name;
        document.getElementById("modal-venue").textContent = event.venue;
        document.getElementById("modal-date").textContent = event.date;
        document.getElementById("modal-time").textContent = event.time;
        document.getElementById("modal-type").textContent = event.type;
        document.getElementById("modal-eligibility").textContent =
          event.eligibility;
        document.getElementById("modal-description").textContent =
          event.description;

        // Generate image gallery
        const galleryContainer = document.getElementById(
          "modal-gallery-container"
        );
        galleryContainer.innerHTML = "";

        event.images.forEach((image, index) => {
          const imgElement = document.createElement("img");
          imgElement.src = image;
          imgElement.alt = `${event.name} - Image ${index + 1}`;
          imgElement.className = index === 0 ? "active" : "";

          // Add click event to switch main image
          imgElement.addEventListener("click", function () {
            document.getElementById("modal-image").src = image;
            currentImageIndex = index;

            // Update active state in gallery
            const galleryImages = galleryContainer.querySelectorAll("img");
            galleryImages.forEach((img, i) => {
              img.className = i === index ? "active" : "";
            });
          });

          galleryContainer.appendChild(imgElement);
        });

        // Show modal
        document.getElementById("event-modal").style.display = "flex";
      }

      // Close event details modal
      function closeModal() {
        document.getElementById("event-modal").style.display = "none";
      }

      // Open edit modal
      function openEditModal(eventId) {
        const event = events.find((e) => e.id === eventId);
        if (!event) return;

        currentEventBeingEdited = event;

        // Set form values
        document.getElementById("edit-name").value = event.name;
        document.getElementById("edit-venue").value = event.venue;
        document.getElementById("edit-date").value = event.date;
        document.getElementById("edit-time").value = event.time;
        document.getElementById("edit-type").value = event.type;
        document.getElementById("edit-eligibility").value = event.eligibility;
        document.getElementById("edit-description").value = event.description;

        // Display image previews
        const imagePreview = document.getElementById("image-preview");
        imagePreview.innerHTML = "";

        event.images.forEach((image, index) => {
          const previewItem = document.createElement("div");
          previewItem.className = "image-preview-item";
          previewItem.innerHTML = `
                    <img src="${image}" alt="Event Image ${index + 1}">
                    <button class="remove-image" data-index="${index}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
          imagePreview.appendChild(previewItem);

          // Add event listener for remove button
          previewItem
            .querySelector(".remove-image")
            .addEventListener("click", function () {
              removeImageFromEvent(index);
            });
        });

        // Show modal
        document.getElementById("edit-modal").style.display = "flex";
      }

      // Close edit modal
      function closeEditModal() {
        document.getElementById("edit-modal").style.display = "none";
        currentEventBeingEdited = null;
      }

      // Initialize edit form
      function initializeEditForm() {
        const form = document.getElementById("edit-event-form");
        const fileInput = document.getElementById("edit-images");

        // Handle form submission
        form.addEventListener("submit", function (e) {
          e.preventDefault();
          saveEventChanges();
        });

        // Handle file input change
        fileInput.addEventListener("change", function (e) {
          const files = e.target.files;
          if (files.length > 0) {
            addImagesToEvent(files);
          }
        });
      }

      // Save event changes
      function saveEventChanges() {
        if (!currentEventBeingEdited) return;

        // Update event data
        currentEventBeingEdited.name =
          document.getElementById("edit-name").value;
        currentEventBeingEdited.venue =
          document.getElementById("edit-venue").value;
        currentEventBeingEdited.date =
          document.getElementById("edit-date").value;
        currentEventBeingEdited.time =
          document.getElementById("edit-time").value;
        currentEventBeingEdited.type =
          document.getElementById("edit-type").value;
        currentEventBeingEdited.eligibility =
          document.getElementById("edit-eligibility").value;
        currentEventBeingEdited.description =
          document.getElementById("edit-description").value;

        // In a real application, you would send this data to the server here
        console.log("Event updated:", currentEventBeingEdited);

        // Re-render events to show changes
        renderEvents();

        // Close modal
        closeEditModal();

        // Show success message
        alert("Event updated successfully!");
      }

      // Add images to event
      function addImagesToEvent(files) {
        if (!currentEventBeingEdited) return;

        // In a real application, you would upload these files to a server
        // For this demo, we'll just add placeholder URLs
        Array.from(files).forEach((file) => {
          const reader = new FileReader();
          reader.onload = function (e) {
            // Add the image to the event
            currentEventBeingEdited.images.push(e.target.result);

            // Add the image to the preview
            const imagePreview = document.getElementById("image-preview");
            const previewItem = document.createElement("div");
            previewItem.className = "image-preview-item";
            previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="New Event Image">
                        <button class="remove-image" data-index="${
                          currentEventBeingEdited.images.length - 1
                        }">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
            imagePreview.appendChild(previewItem);

            // Add event listener for remove button
            previewItem
              .querySelector(".remove-image")
              .addEventListener("click", function () {
                removeImageFromEvent(currentEventBeingEdited.images.length - 1);
              });
          };
          reader.readAsDataURL(file);
        });
      }

      // Remove image from event
      function removeImageFromEvent(index) {
        if (!currentEventBeingEdited || !currentEventBeingEdited.images[index])
          return;

        // Remove the image
        currentEventBeingEdited.images.splice(index, 1);

        // Re-render the preview
        const imagePreview = document.getElementById("image-preview");
        imagePreview.innerHTML = "";

        currentEventBeingEdited.images.forEach((image, newIndex) => {
          const previewItem = document.createElement("div");
          previewItem.className = "image-preview-item";
          previewItem.innerHTML = `
                    <img src="${image}" alt="Event Image ${newIndex + 1}">
                    <button class="remove-image" data-index="${newIndex}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
          imagePreview.appendChild(previewItem);

          // Add event listener for remove button
          previewItem
            .querySelector(".remove-image")
            .addEventListener("click", function () {
              removeImageFromEvent(newIndex);
            });
        });
      }

      // Open zoom modal for images
      function openZoomModal(eventId, imageIndex = 0) {
        const event = events.find((e) => e.id === eventId);
        if (!event) return;

        currentEventId = eventId;
        currentEventImages = event.images;
        currentImageIndex = imageIndex;

        // Set zoom image
        document.getElementById("zoom-image").src = event.images[imageIndex];

        // Generate indicators
        const indicatorsContainer = document.getElementById("zoom-indicators");
        indicatorsContainer.innerHTML = "";

        event.images.forEach((_, index) => {
          const indicator = document.createElement("div");
          indicator.className = `zoom-indicator ${
            index === imageIndex ? "active" : ""
          }`;
          indicator.setAttribute("data-index", index);

          indicator.addEventListener("click", function () {
            const newIndex = parseInt(this.getAttribute("data-index"));
            updateZoomImage(newIndex);
          });

          indicatorsContainer.appendChild(indicator);
        });

        // Show zoom modal
        document.getElementById("zoom-modal").style.display = "flex";
      }

      // Close zoom modal
      function closeZoom() {
        document.getElementById("zoom-modal").style.display = "none";
      }

      // Navigate through images in zoom modal
      function zoomSlideImage(direction) {
        let newIndex = currentImageIndex + direction;

        // Handle wrapping around
        if (newIndex < 0) {
          newIndex = currentEventImages.length - 1;
        } else if (newIndex >= currentEventImages.length) {
          newIndex = 0;
        }

        updateZoomImage(newIndex);
      }

      // Update zoom image based on index
      function updateZoomImage(newIndex) {
        currentImageIndex = newIndex;

        // Update image
        document.getElementById("zoom-image").src =
          currentEventImages[newIndex];

        // Update indicators
        const indicators = document.querySelectorAll(".zoom-indicator");
        indicators.forEach((indicator, index) => {
          indicator.className = `zoom-indicator ${
            index === newIndex ? "active" : ""
          }`;
        });
      }

      // Edit event from modal
      function editEvent(button) {
        if (currentEventId) {
          openEditModal(currentEventId);
          closeModal();
        }
      }

      // Initialize search functionality
      function initializeSearch() {
        const searchInput = document.getElementById("search");

        searchInput.addEventListener("input", function () {
          const searchTerm = this.value.toLowerCase();

          // Filter events based on search term
          const filteredEvents = events.filter((event) => {
            return (
              event.name.toLowerCase().includes(searchTerm) ||
              event.venue.toLowerCase().includes(searchTerm) ||
              event.type.toLowerCase().includes(searchTerm) ||
              event.description.toLowerCase().includes(searchTerm) ||
              event.eligibility.toLowerCase().includes(searchTerm)
            );
          });

          // Re-render events with filtered list
          renderFilteredEvents(filteredEvents);
        });
      }

      // Render filtered events
      function renderFilteredEvents(filteredEvents) {
        const eventsContainer = document.getElementById("events-container");
        eventsContainer.innerHTML = "";

        if (filteredEvents.length === 0) {
          eventsContainer.innerHTML = `
                    <div class="no-events">
                        <i class="fas fa-search"></i>
                        <p>No events found matching your search</p>
                    </div>
                `;
          return;
        }

        filteredEvents.forEach((event) => {
          const eventCard = document.createElement("div");
          eventCard.className = "event-card";
          eventCard.innerHTML = `
                    <div class="event-image" data-event-id="${event.id}">
                        <img src="${event.images[0]}" alt="${event.name}">
                        <div class="event-type-badge ${event.type.toLowerCase()}">${
            event.type
          }</div>
                        <div class="eligibility-badge ${
                          event.isEligible ? "yes" : "no"
                        }">
                            ${event.isEligible ? "Eligible" : "Not Eligible"}
                        </div>
                    </div>
                    <div class="event-details">
                        <h3 class="event-name">${event.name}</h3>
                        <div class="event-info">
                            <i class="fas fa-map-marker-alt"></i> ${event.venue}
                        </div>
                        <div class="event-info">
                            <i class="fas fa-calendar"></i> ${event.date}
                        </div>
                        <div class="event-info">
                            <i class="fas fa-clock"></i> ${event.time}
                        </div>
                        <div class="event-actions">
                            <button class="btn btn-outline view-details" data-event-id="${
                              event.id
                            }">
                                <i class="fas fa-info-circle"></i> View Details
                            </button>
                            <button class="btn btn-warning edit-btn" data-event-id="${
                              event.id
                            }">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                        </div>
                    </div>
                `;

          eventsContainer.appendChild(eventCard);
        });

        // Re-attach event listeners
        attachEventListeners();
      }
    </script>
  </body>
</html>
